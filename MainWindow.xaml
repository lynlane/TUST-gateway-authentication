<Window x:Class="TUST_gateway_authentication.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr:namespace:TUST_gateway_authentication"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        StateChanged="Window_StateChanged"
        mc:Ignorable="d"
        Title="TUST 网关认证" Height="660" Width="380"
        ResizeMode="CanMinimize"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- 定义颜色资源 -->
        <Color x:Key="PrimaryColor">#aaF0F8FF</Color>
        <Color x:Key="SecondaryColor">#aa7AB4EA</Color>
        <Color x:Key="AccentColor">#2B579A</Color>
        <Color x:Key="LightBackground">#aaffffff</Color>
        <Color x:Key="MediumBackground">#E6F0FA</Color>
        <Color x:Key="TextColor">#2D3748</Color>
        <Color x:Key="SubtleTextColor">#718096</Color>
        <Color x:Key="AlertColor">#E53E3E</Color>

        <!-- 转换为SolidColorBrush -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="{StaticResource PrimaryColor}"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="{StaticResource SecondaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="LightBackgroundBrush" Color="{StaticResource LightBackground}"/>
        <SolidColorBrush x:Key="MediumBackgroundBrush" Color="{StaticResource MediumBackground}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}"/>
        <SolidColorBrush x:Key="SubtleTextBrush" Color="{StaticResource SubtleTextColor}"/>
        <SolidColorBrush x:Key="AlertBrush" Color="{StaticResource AlertColor}"/>

        <!-- 定义常用样式 -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Height" Value="28"/>
        </Style>

        <Style TargetType="PasswordBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Height" Value="28"/>
        </Style>

        <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- 主边框 -->
                            <Border x:Name="Border" 
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="2"
                            SnapsToDevicePixels="True">
                                <Grid>
                                    <!-- 内容显示区域 -->
                                    <ContentPresenter x:Name="ContentSite"
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            Margin="{TemplateBinding Padding}"
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                                    <!-- 下拉按钮 -->
                                    <ToggleButton x:Name="DropDownButton"
                                        Grid.Column="1"
                                        Focusable="False"
                                        IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                        ClickMode="Press">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border x:Name="BtnBorder"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="0,0,0,0"
                                                Background="Transparent"
                                                SnapsToDevicePixels="True">
                                                    <!-- 默认隐藏箭头 -->
                                                    <Path x:Name="Arrow"
                                                  Data="M0,0 L4,4 L8,0 Z"
                                                  Fill="#6B7280" 
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Width="8"
                                                  Height="4"
                                                  Visibility="Collapsed"
                                                  SnapsToDevicePixels="True"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <!-- 鼠标悬停时显示箭头 -->
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="BtnBorder" Property="Background" Value="#F3F4F6"/>
                                                        <Setter TargetName="Arrow" Property="Visibility" Value="Visible"/>
                                                    </Trigger>

                                                    <!-- 下拉框打开时始终显示箭头 -->
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="BtnBorder" Property="Background" Value="#E5E7EB"/>
                                                        <Setter TargetName="Arrow" Property="Visibility" Value="Visible"/>
                                                    </Trigger>

                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter TargetName="Arrow" Property="Fill" Value="#D1D5DB"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                    </ToggleButton>
                                </Grid>
                            </Border>

                            <!-- 下拉弹出窗口 -->
                            <Popup x:Name="Popup"
                           AllowsTransparency="True"
                           Focusable="False"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           Placement="Bottom"
                           PopupAnimation="Fade">
                                <Border x:Name="DropDownBorder"
                                Background="White"
                                BorderBrush="#D1D5DB"
                                BorderThickness="1"
                                CornerRadius="2"
                                SnapsToDevicePixels="True">
                                    <ScrollViewer x:Name="DropDownScrollViewer"
                                          SnapsToDevicePixels="True">
                                        <Grid RenderOptions.ClearTypeHint="Enabled">
                                            <Canvas HorizontalAlignment="Left" Height="0" VerticalAlignment="Top" Width="30">
                                                <Rectangle x:Name="OpaqueRect" Fill="{Binding Background, ElementName=DropDownBorder}" Height="{Binding ActualHeight, ElementName=DropDownBorder}" Width="{Binding ActualWidth, ElementName=DropDownBorder}"/>
                                            </Canvas>
                                            <ItemsPresenter x:Name="ItemsPresenter"
                                                   SnapsToDevicePixels="True"/>
                                        </Grid>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsDropDownOpen" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#9CA3AF"/>
                            </Trigger>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#9CA3AF"/>
                                <Setter TargetName="Border" Property="Background" Value="#F9FAFB"/>
                            </Trigger>
                            <Trigger Property="IsGrouping" Value="True">
                                <Setter Property="ScrollViewer.CanContentScroll" Value="False"/>
                            </Trigger>
                            <Trigger SourceName="Popup" Property="Popup.AllowsTransparency" Value="True">
                                <Setter TargetName="DropDownBorder" Property="CornerRadius" Value="2"/>
                                <Setter TargetName="DropDownBorder" Property="Margin" Value="0,2,0,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="4" Opacity="0.2" ShadowDepth="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SecondaryBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 状态日志的折叠按钮样式 -->
        <Style x:Key="StatusExpanderStyle" TargetType="Expander">
            <Setter Property="Background" Value="{StaticResource LightBackgroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CBD5E0"/>
            <Setter Property="Margin" Value="0,10,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Background="{TemplateBinding Background}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 头部区域（总是显示） -->
                                <ToggleButton x:Name="HeaderButton"
                                              Grid.Row="0"
                                              IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                              Background="Transparent"
                                              BorderThickness="0"
                                              Padding="5"
                                              Height="30">
                                    <DockPanel>
                                        <TextBlock Text="{TemplateBinding Header}" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource AccentBrush}" 
                                                   VerticalAlignment="Center"/>
                                        <Path x:Name="ExpandCollapseIcon" 
                                              DockPanel.Dock="Right"
                                              Fill="{StaticResource AccentBrush}" 
                                              HorizontalAlignment="Right"
                                              VerticalAlignment="Center"
                                              Margin="5,0,5,0"
                                              Data="M0,0 L8,0 L4,5 Z">
                                            <Path.RenderTransform>
                                                <RotateTransform Angle="0" CenterX="4" CenterY="2.5"/>
                                            </Path.RenderTransform>
                                        </Path>
                                    </DockPanel>
                                </ToggleButton>

                                <!-- 内容区域 -->
                                <ContentPresenter x:Name="ExpandContent"
                                                  Grid.Row="1"
                                                  Visibility="Collapsed"
                                                  Margin="5"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger SourceName="HeaderButton" Property="IsChecked" Value="True">
                                <Setter TargetName="ExpandContent" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ExpandCollapseIcon" Property="RenderTransform">
                                    <Setter.Value>
                                        <RotateTransform Angle="180" CenterX="4" CenterY="2.5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="GroupBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#CBD5E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4" 
                                Background="{StaticResource LightBackgroundBrush}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Border Background="{StaticResource PrimaryBrush}" 
                                        CornerRadius="3,3,0,0"
                                        Margin="0,0,0,5" 
                                        Height="28" 
                                        Padding="10,0">
                                    <TextBlock Text="{TemplateBinding Header}" 
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource AccentBrush}" 
                                               VerticalAlignment="Center"/>
                                </Border>
                                <ContentPresenter Grid.Row="1" Margin="5"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Grid Name="Panel" Background="Transparent">
                            <ContentPresenter x:Name="ContentSite" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center" 
                                              ContentSource="Header"
                                              Margin="10,2" 
                                              RecognizesAccessKey="True"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="ContentSite" Property="TextElement.FontWeight" Value="SemiBold"/>
                                <Setter TargetName="ContentSite" Property="TextElement.Foreground" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="Panel" Property="Background" Value="Transparent"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="ContentSite" Property="TextElement.Foreground" Value="{StaticResource TextBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Expander">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CBD5E0"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Background" Value="{StaticResource LightBackgroundBrush}">
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4" 
                                Background="{StaticResource LightBackgroundBrush}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <ToggleButton Name="HeaderSite" 
                                              IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                              Background="Transparent" 
                                              BorderThickness="0" 
                                              Padding="0">
                                    <Grid>
                                        <TextBlock Text="{TemplateBinding Header}" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource AccentBrush}" 
                                                   VerticalAlignment="Center"
                                                   Margin="8,5"/>
                                        <Path Name="Arrow" 
                                              Fill="{StaticResource AccentBrush}" 
                                              HorizontalAlignment="Right" 
                                              VerticalAlignment="Center"
                                              Margin="0,0,10,0" 
                                              Data="M 0 0 L 8 0 L 4 5 Z">
                                            <Path.RenderTransform>
                                                <RotateTransform Angle="0" CenterX="4" CenterY="2.5"/>
                                            </Path.RenderTransform>
                                        </Path>
                                    </Grid>
                                </ToggleButton>
                                <ContentPresenter Grid.Row="1" 
                                                  x:Name="ExpandSite" 
                                                  Margin="5" 
                                                  Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger SourceName="HeaderSite" Property="IsChecked" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="Arrow" Property="RenderTransform">
                                    <Setter.Value>
                                        <RotateTransform Angle="180" CenterX="4" CenterY="2.5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Hyperlink">
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="TextDecorations" Value="None"/>
        </Style>
        <Style x:Key="HiddenScrollbarStyle" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <!-- 内容呈现区域 -->
                            <Border Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}">
                                <ScrollContentPresenter x:Name="PART_ContentPresenter"
                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>

                            <!-- 隐藏的水平滚动条 -->
                            <ScrollBar x:Name="HorizontalScrollBar"
                        Visibility="Collapsed"
                        Orientation="Horizontal"
                        Grid.Row="1"
                        Grid.Column="0"
                        Maximum="{TemplateBinding ScrollableWidth}"
                        ViewportSize="{TemplateBinding ViewportWidth}"
                        Value="{Binding Path=HorizontalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}"
                        IsEnabled="{TemplateBinding CanContentScroll}"/>

                            <!-- 隐藏的垂直滚动条 -->
                            <ScrollBar x:Name="VerticalScrollBar"
                        Visibility="Collapsed"
                        Orientation="Vertical"
                        Grid.Row="0"
                        Grid.Column="1"
                        Maximum="{TemplateBinding ScrollableHeight}"
                        ViewportSize="{TemplateBinding ViewportHeight}"
                        Value="{Binding Path=VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}"
                        IsEnabled="{TemplateBinding CanContentScroll}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <VisualBrush x:Key="BlurredBackgroundBrush">
            <VisualBrush.Visual>
                <!-- 使用白色矩形代替图像背景 -->
                <!--<Rectangle Fill="White"
                   Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                   Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"/> -->
                <Image Source="pack://application:,,,/res/background.jpg"
                   Stretch="UniformToFill"
                   Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                   Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}">
                    <Image.Effect>
                        <BlurEffect Radius="0"/>
                    </Image.Effect>
                </Image> 
            </VisualBrush.Visual>
        </VisualBrush>
    </Window.Resources>

    <Window.Background>
        <StaticResource ResourceKey="BlurredBackgroundBrush"/>
    </Window.Background>

    <Grid>
        <Grid>
    <Rectangle Stroke="#0A1AA4"
StrokeThickness="1"
StrokeDashArray="2 2"
Margin="6,6,6,6"
HorizontalAlignment="Stretch"
VerticalAlignment="Stretch"/>
    <Grid Margin="10">
        <TabControl>
                <TabItem Header="基本设置">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Style="{StaticResource HiddenScrollbarStyle}">
                        <Grid Margin="0,5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 账户信息 -->
                            <GroupBox Grid.Row="0" Header="统一身份认证账户">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="账号:" Grid.Column="0" VerticalAlignment="Center" Margin="5"/>
                                    <TextBox x:Name="txtAccount" Grid.Column="1"/>

                                    <TextBlock Text="密码:" Grid.Column="2" VerticalAlignment="Center" Margin="5"/>
                                    <PasswordBox x:Name="txtPassword" Grid.Column="3"/>
                                </Grid>
                            </GroupBox>

                            <!-- 操作按钮 -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="5,0">
                                <Button Grid.Row="1" x:Name="btnLogin" Content="开始维持认证" 
                                    Height="40" Margin="5,0" FontSize="14" 
                                    Click="btnLogin_Click"
                                    FontWeight="Bold" Background="#E6F0FA" HorizontalAlignment="Left" Width="140"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="20,0,0,0">
                                <!-- 注销按钮 -->
                                <TextBlock HorizontalAlignment="Center" Margin="5,0,5,5">
                                    <Hyperlink x:Name="lnkLogout" Click="LogoutLink_Click" 
                                               Foreground="{StaticResource AccentBrush}">
                                        <Run Text="注销认证"/>
                                    </Hyperlink>
                                </TextBlock>
                                <!-- 记住配置 -->
                                <CheckBox x:Name="chkSavePassword" Content="记住配置" 
                                              VerticalAlignment="Center" Margin="15,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                            
                            <!-- 本机网络参数 -->
                            <GroupBox Grid.Row="2" Header="希望申请或注销的IP" Margin="0,10,0,0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                
                                

                                    <!-- 第一组IP -->
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="IPv4地址:" VerticalAlignment="Center" Margin="5"/>
                                    <TextBox x:Name="txtWlanUserIp" Grid.Row="2" Grid.Column="1" Margin="5"/>

                                    <TextBlock x:Name="txtIpv6Label1" Grid.Row="3" Grid.Column="0" Text="IPv6地址:" VerticalAlignment="Center" Margin="5"/>
                                    <TextBox x:Name="txtWlanUserIpv6" Grid.Row="3" Grid.Column="1" Margin="5"/>

                                    <!-- Group 1 Terminal Type/Operator -->
                                    <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Visibility="Collapsed" x:Name="group1OperatorPanel">
                                        <TextBlock Text="终端类型:" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                    <ComboBox x:Name="cmbGroup1TerminalType" Margin="8,0,0,0" Width="100" Height="27">
                                            <ComboBoxItem Content="PC" IsSelected="True" Tag="0"/>
                                            <ComboBoxItem Content="移动终端" Tag="1"/>
                                        </ComboBox>

                                        <TextBlock Text="运营商:" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                        <ComboBox x:Name="cmbGroup1Operator" Width="100" Height="27" SelectedIndex="0" Margin="5">
                                            <ComboBoxItem>中国联通</ComboBoxItem>
                                            <ComboBoxItem>中国电信</ComboBoxItem>
                                            <ComboBoxItem>中国移动</ComboBoxItem>
                                            <ComboBoxItem>校园网</ComboBoxItem>
                                        </ComboBox>
                                    </StackPanel>

                                    <Button Grid.Row="5" Grid.Column="1" x:Name="btnRefreshIPs" 
                                        Content="获取本机IP" HorizontalAlignment="Right" 
                                        Width="120" Margin="5"
                                        Click="btnRefreshIPs_Click" 
                                        ToolTip="获取当前设备活动IP地址"/>

                                    <!-- 分割线 -->
                                    <Separator Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3" Margin="5" Background="#CCCCCC" Height="1" Visibility="Collapsed" x:Name="sepIPGroupDivider"/>

                                    <!-- 第二组IP (默认隐藏) -->
                                

                                    <TextBlock x:Name="txtIpv4Label2" Grid.Row="8" Grid.Column="0" Text="IPv4地址:" VerticalAlignment="Center" Margin="5" Visibility="Collapsed">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                <DataTrigger Binding="{Binding ElementName=chkGroup2Enabled, Path=Visibility}" Value="Visible">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                <TextBox x:Name="txtWlanUserIp2" Grid.Row="8" Grid.Column="1" Margin="5" Visibility="Collapsed"/>

                                    <TextBlock x:Name="txtIpv6Label2" Grid.Row="9" Grid.Column="0" Text="IPv6地址:" VerticalAlignment="Center" Margin="5" Visibility="Collapsed">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ElementName=chkGroup2Enabled, Path=Visibility}" Value="Visible">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBox x:Name="txtWlanUserIpv6_2" Grid.Row="9" Grid.Column="1" Margin="5" Visibility="Collapsed"/>

                                    <!-- Group 2 Terminal Type/Operator -->
                                    <StackPanel Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Visibility="Collapsed" x:Name="group2OperatorPanel">
                                        <TextBlock Text="设备类型:" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                    <ComboBox x:Name="cmbGroup2TerminalType" Margin="8,0,0,0" Width="100" Height="27">
                                            <ComboBoxItem Content="PC" IsSelected="True" Tag="0"/>
                                            <ComboBoxItem Content="移动终端" Tag="1"/>
                                        </ComboBox>

                                        <TextBlock Text="运营商:" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                        <ComboBox x:Name="cmbGroup2Operator" Width="100" Height="27" SelectedIndex="0" Margin="5">
                                            <ComboBoxItem>中国联通</ComboBoxItem>
                                            <ComboBoxItem>中国电信</ComboBoxItem>
                                            <ComboBoxItem>中国移动</ComboBoxItem>
                                            <ComboBoxItem>校园网</ComboBoxItem>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                            </GroupBox>

                        <TextBlock Grid.Row="2" x:Name="tblkAddIPGroup" HorizontalAlignment="Right" FontSize="28" Margin="5,3,10,0" VerticalAlignment="Top">
                            <Hyperlink x:Name="lnkAddIPGroup" Click="lnkAddIPGroup_Click">
                                <Run Text="+"/>
                            </Hyperlink>
                        </TextBlock>

                        <!-- 终端类型 (Unified version) -->
                            <GroupBox x:Name="unifiedOperatorGroup" Grid.Row="3" Header="终端类型、运营商选项" Margin="0,10,0,0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5,0">
                                        <ComboBox x:Name="cmbTerminalType" Margin="0,0,10,5" Width="120">
                                            <ComboBoxItem Content="PC" IsSelected="True" Tag="0"/>
                                            <ComboBoxItem Content="移动终端" Tag="1"/>
                                        </ComboBox>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Orientation="Horizontal">
                                        <ComboBox x:Name="cmbOperator" Width="120" Height="27" SelectedIndex="0" Margin="5">
                                            <ComboBoxItem>中国联通</ComboBoxItem>
                                            <ComboBoxItem>中国电信</ComboBoxItem>
                                            <ComboBoxItem>中国移动</ComboBoxItem>
                                            <ComboBoxItem>校园网</ComboBoxItem>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                            </GroupBox>

                            <!-- IP组状态显示 -->

                            <GroupBox Grid.Row="4" Header="认证状态" Margin="0,10,0,0" >
                                <StackPanel Grid.Row="8" Orientation="Vertical" Margin="5,0,0,0" HorizontalAlignment="Left">
                                    <TextBlock x:Name="txtGroup1Status" Foreground="#aaaaaa" FontSize="12" Text="IP 组 1：未开始"/>
                                    <TextBlock x:Name="txtGroup2Status" Foreground="#aaaaaa" FontSize="12" Text="IP 组 2：未启用" Visibility="Collapsed"/>
                                </StackPanel>
                            </GroupBox>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="其他设置">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Style="{StaticResource HiddenScrollbarStyle}">
                        <Grid Margin="0,5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 基本设置页的组件 -->
                            <GroupBox Grid.Row="0" Header="基本设置页的组件" Margin="0,5,0,5">
                                <StackPanel>
                                    <CheckBox x:Name="chkShowIPv6" Content="显示IPv6地址配置项" Margin="5" IsChecked="False"/>
                                <CheckBox x:Name="chkShowTerminalType" Content="显示终端类型、运营商配置项" Margin="5" IsChecked="True"/>
                                    <CheckBox x:Name="chkDistinguishGroups" Content="区分不同IP组的终端类型、运营商" Margin="5" IsChecked="True"/>
                                </StackPanel>
                            </GroupBox>

                            <!-- 默认参数 -->
                                <Expander Grid.Row="1" Header="默认参数    " Margin="0,5,0,5">
                                <StackPanel>
                                    <TextBlock Margin="0,0,0,5" FontWeight="SemiBold" 
                                           Foreground="{StaticResource AccentBrush}"
                                           Text="除非知道自己在做什么，否则不建议修改"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="认证网关:" Grid.Row="0" Grid.Column="0" 
                                               VerticalAlignment="Center" Margin="5"/>
                                        <TextBox x:Name="txtAuthGateway" Grid.Row="0" Grid.Column="1"
                                             Margin="5" ToolTip="例如: 10.10.102.50:801"/>

                                        <TextBlock Text="登录方式:" Grid.Row="1" Grid.Column="0" 
                                               VerticalAlignment="Center" Margin="5"/>
                                        <TextBox x:Name="txtLoginMethod" Grid.Row="1" Grid.Column="1"
                                             Margin="5" ToolTip="通常为1"/>

                                        <TextBlock Text="注销账户:" Grid.Row="2" Grid.Column="0" 
                                               VerticalAlignment="Center" Margin="5"/>
                                        <TextBox x:Name="txtLogoutAccount" Grid.Row="2" Grid.Column="1"
                                             Margin="5" ToolTip="例如: drcom"/>

                                        <TextBlock Text="注销密码:" Grid.Row="3" Grid.Column="0" 
                                               VerticalAlignment="Center" Margin="5"/>
                                        <TextBox x:Name="txtLogoutPassword" Grid.Row="3" Grid.Column="1"
                                             Margin="5" ToolTip="例如: 123"/>
                                    </Grid>

                                    <Expander Header="预留参数    " Margin="0,10,0,0" IsExpanded="False">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <TextBlock Text="Callback:" Grid.Row="0" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtCallback" Grid.Row="0" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="MAC地址:" Grid.Row="1" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtWlanUserMac" Grid.Row="1" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="AC IP:" Grid.Row="2" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtWlanAcIp" Grid.Row="2" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="VLAN ID:" Grid.Row="3" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtWlanVlanId" Grid.Row="3" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="JS版本:" Grid.Row="4" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtJsVersion" Grid.Row="4" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="验证版本:" Grid.Row="5" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtV" Grid.Row="5" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="terminal_type:" Grid.Row="6" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtTerminalType" Grid.Row="6" Grid.Column="1" Margin="5"/>

                                            <TextBlock Text="注销模式:" Grid.Row="7" Grid.Column="0" 
                                                   VerticalAlignment="Center" Margin="5"/>
                                            <TextBox x:Name="txtAcLogout" Grid.Row="7" Grid.Column="1" Margin="5"/>
                                        </Grid>
                                    </Expander>
                                </StackPanel>
                            </Expander>

                            <!-- URL解析 -->
                            <Expander Grid.Row="2" Header="URL解析    " IsExpanded="False">
                                <StackPanel>
                                    <TextBlock Margin="5,5,5,2" TextWrapping="Wrap" 
                                           Foreground="{StaticResource SubtleTextBrush}" FontSize="12">
粘贴从官方认证页面登录或注销时发送的URL请求
                                    </TextBlock>
                                    <TextBox x:Name="txtFullUrl" Margin="5" ToolTip="粘贴完整登录或注销URL"/>
                                    <Button x:Name="btnParse" Content="解析URL参数" Margin="5" 
                                        Click="ParseUrl_Click"
                                        ToolTip="自动提取URL中的参数"/>
                                </StackPanel>
                            </Expander>

                            <!-- 循环认证时间间隔 -->
                            <GroupBox Grid.Row="3" Header="认证请求的时间间隔" Margin="0,5,0,5">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Column="0" Margin="5">
                                        <TextBlock Text="在线间隔 (秒)" Margin="0,0,0,2" 
                                               Foreground="{StaticResource SubtleTextBrush}"/>
                                        <TextBox x:Name="txtOnlineInterval" Text="20" Margin="0,0,0,5"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="5">
                                        <TextBlock Text="离线间隔 (秒)" Margin="0,0,0,2" 
                                               Foreground="{StaticResource SubtleTextBrush}"/>
                                        <TextBox x:Name="txtOfflineInterval" Text="1" Margin="0,0,0,5"/>
                                    </StackPanel>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                           Margin="5,5,5,0" TextWrapping="Wrap" FontSize="12" 
                                           Foreground="{StaticResource SubtleTextBrush}" 
                                           Text="设置再次确认认证的间隔时间。"/>
                                </Grid>
                            </GroupBox>

                            <!-- 开机自启动 -->
                            <GroupBox Grid.Row="4" Header="启动选项" Margin="0,5,0,5">
                                <StackPanel>
                                    <CheckBox x:Name="chkAutoStart" Content="开机自动启动此程序" Margin="5" 
                                          Click="chkAutoStart_Click" 
                                          Foreground="{StaticResource TextBrush}"/>

                                    <CheckBox x:Name="chkAutoHideOnStart" Content="程序启动时自动隐藏（仅托盘运行）" Margin="5" 
                                          Foreground="{StaticResource TextBrush}"/>

                                        <!-- 新增：启动时自动认证 -->
                                    <CheckBox x:Name="chkAutoAuth" Content="程序启动时自动按配置进行认证" Margin="5" 
                                          Foreground="{StaticResource TextBrush}"/>

                                    <TextBlock Margin="5,0" TextWrapping="Wrap" FontSize="12" 
                                           Foreground="{StaticResource SubtleTextBrush}"
                                           Text="在基本设置页中勾选保存配置，并点击开始维持认证后生效"/>
                                </StackPanel>
                            </GroupBox>

                            <!-- 状态日志 (添加折叠功能) -->
                            <Expander Grid.Row="5" Header="状态日志" Margin="0,10,0,5" Padding="0" Style="{StaticResource StatusExpanderStyle}">
                                <Border BorderThickness="0" CornerRadius="3" Background="White" Height="150">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                                        <TextBlock x:Name="txtStatus" TextWrapping="Wrap" FontSize="12" Foreground="{StaticResource TextBrush}"/>
                                    </ScrollViewer>
                                </Border>
                            </Expander>

                            <!-- 版本信息 -->
                            <StackPanel Grid.Row="6" Orientation="Horizontal" 
                                    HorizontalAlignment="Right" Margin="0,15,10,0">
                                <TextBlock Text="版本: V0.2.0" 
                                       Foreground="{StaticResource SubtleTextBrush}"/>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
    </Grid>
    </Grid>
        <!-- 系统托盘图标 -->
        <tb:TaskbarIcon x:Name="TrayIcon"
      IconSource="pack://application:,,,/res/gateway2.ico"  
            ToolTipText="TUST 网关认证助手"
      TrayLeftMouseDown="TrayIcon_TrayLeftMouseDown">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="显示窗口" Click="ShowWindow_Click"/>
                    <!-- 新增：动态认证开关选项 -->
                    <MenuItem x:Name="ToggleAuthMenu" Click="ToggleAuthMenu_Click"/>
                    <Separator/>
                    <MenuItem Header="退出" Click="ExitApp_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Grid>
</Window>
    
    
    
    